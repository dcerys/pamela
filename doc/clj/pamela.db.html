<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pamela.db documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Pamela 0.2.2-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pamela</span></div></div></li><li class="depth-2 branch"><a href="pamela.cli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="pamela.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="pamela.daemon.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemon</span></div></a></li><li class="depth-2 branch current"><a href="pamela.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="pamela.log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-2 branch"><a href="pamela.mode.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mode</span></div></a></li><li class="depth-2 branch"><a href="pamela.models.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>models</span></div></a></li><li class="depth-2 branch"><a href="pamela.pclass.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pclass</span></div></a></li><li class="depth-2 branch"><a href="pamela.tpn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tpn</span></div></a></li><li class="depth-2 branch"><a href="pamela.tpnrecords.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tpnrecords</span></div></a></li><li class="depth-2 branch"><a href="pamela.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2"><a href="pamela.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="pamela.db.html#var-db"><div class="inner"><span>db</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-db-conn"><div class="inner"><span>db-conn</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-db-index"><div class="inner"><span>db-index</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-db-mapping-types"><div class="inner"><span>db-mapping-types</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-db-node"><div class="inner"><span>db-node</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-delete-all-models"><div class="inner"><span>delete-all-models</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-delete-model"><div class="inner"><span>delete-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-delete-model-by-id"><div class="inner"><span>delete-model-by-id</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-describe-model"><div class="inner"><span>describe-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-es-to-model"><div class="inner"><span>es-to-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-export-model"><div class="inner"><span>export-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-get-model"><div class="inner"><span>get-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-import-model"><div class="inner"><span>import-model</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-list-models"><div class="inner"><span>list-models</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-running.3F"><div class="inner"><span>running?</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-settings"><div class="inner"><span>settings</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-start-db"><div class="inner"><span>start-db</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-start-db-pamela"><div class="inner"><span>start-db-pamela</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-start-db-remote"><div class="inner"><span>start-db-remote</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-stop-db"><div class="inner"><span>stop-db</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-stop-db-exit"><div class="inner"><span>stop-db-exit</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-sync-models-to-db"><div class="inner"><span>sync-models-to-db</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-wait-for-green"><div class="inner"><span>wait-for-green</span></div></a></li><li class="depth-1"><a href="pamela.db.html#var-with-db"><div class="inner"><span>with-db</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">pamela.db</h2><div class="doc"><pre class="plaintext">PAMELA database functions.

During development these functions support running Elasticsearch
in standalone mode.

The data storage will be kept in the data/ directory.

Configuration is in the resources/es-config/ directory.</pre></div><div class="public anchor" id="var-db"><h3>db</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-41">view source</a></div></div><div class="public anchor" id="var-db-conn"><h3>db-conn</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(db-conn)</code></div><div class="doc"><pre class="plaintext">Return the current Elasticsearch DB connection used for API calls
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-81">view source</a></div></div><div class="public anchor" id="var-db-index"><h3>db-index</h3><h4 class="added">added in 0.2.0</h4><div class="usage"></div><div class="doc"><pre class="plaintext">PAMELA index for Elasticsearch
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-70">view source</a></div></div><div class="public anchor" id="var-db-mapping-types"><h3>db-mapping-types</h3><h4 class="added">added in 0.2.0</h4><div class="usage"></div><div class="doc"><pre class="plaintext">PAMELA mapping types for Elasticsearch
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-58">view source</a></div></div><div class="public anchor" id="var-db-node"><h3>db-node</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(db-node)</code></div><div class="doc"><pre class="plaintext">Return the current Elasticsearch DB node used for API calls
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-75">view source</a></div></div><div class="public anchor" id="var-delete-all-models"><h3>delete-all-models</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(delete-all-models &amp; [options])</code></div><div class="doc"><pre class="plaintext">Deletes all the models from the database and models namespace
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-330">view source</a></div></div><div class="public anchor" id="var-delete-model"><h3>delete-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(delete-model options)</code></div><div class="doc"><pre class="plaintext">Deletes given model from the database

Will result in in error if {:model model-name} is
not found unless {:db-only true}. NOTE: will delete
entire database if model-name is :all</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-389">view source</a></div></div><div class="public anchor" id="var-delete-model-by-id"><h3>delete-model-by-id</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(delete-model-by-id id &amp; [options])</code></div><div class="doc"><pre class="plaintext">Deletes given model (given the id) from the database
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-319">view source</a></div></div><div class="public anchor" id="var-describe-model"><h3>describe-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(describe-model options)</code></div><div class="doc"><pre class="plaintext">Analyze and describe the given model
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-521">view source</a></div></div><div class="public anchor" id="var-es-to-model"><h3>es-to-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(es-to-model hit)</code></div><div class="doc"><pre class="plaintext">Convert ES DB data structure to model-data
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-287">view source</a></div></div><div class="public anchor" id="var-export-model"><h3>export-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(export-model options)</code></div><div class="doc"><pre class="plaintext">Export model source from the database
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-436">view source</a></div></div><div class="public anchor" id="var-get-model"><h3>get-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(get-model model)</code></div><div class="doc"><pre class="plaintext">Read a given model from the database

Should not return duplicates, but the results must be verified.
n (:total hits)
hit (first (:hits hits))
id (:_id hit)</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-301">view source</a></div></div><div class="public anchor" id="var-import-model"><h3>import-model</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(import-model options)</code></div><div class="doc"><pre class="plaintext">Import model into the database
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-475">view source</a></div></div><div class="public anchor" id="var-list-models"><h3>list-models</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(list-models &amp; [options])</code></div><div class="doc"><pre class="plaintext">List models in the database
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-368">view source</a></div></div><div class="public anchor" id="var-running.3F"><h3>running?</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(running?)</code></div><div class="doc"><pre class="plaintext">Return true if the Elasticsearch is running
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-87">view source</a></div></div><div class="public anchor" id="var-settings"><h3>settings</h3><h4 class="added">added in 0.2.0</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Settings for standalone Elasticsearch DB
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-43">view source</a></div></div><div class="public anchor" id="var-start-db"><h3>start-db</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(start-db &amp; [options])</code></div><div class="doc"><pre class="plaintext">Start the standalone Elasticsearch DB
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-164">view source</a></div></div><div class="public anchor" id="var-start-db-pamela"><h3>start-db-pamela</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(start-db-pamela &amp; [options])</code></div><div class="doc"><pre class="plaintext">Start the standalone Elasticsearch DB and load all models
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-252">view source</a></div></div><div class="public anchor" id="var-start-db-remote"><h3>start-db-remote</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(start-db-remote &amp; [options])</code></div><div class="doc"><pre class="plaintext">Start the a connection to a remote Elasticsearch DB
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-178">view source</a></div></div><div class="public anchor" id="var-stop-db"><h3>stop-db</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(stop-db &amp; [options])</code></div><div class="doc"><pre class="plaintext">Stop the standalone Elasticsearch DB
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-126">view source</a></div></div><div class="public anchor" id="var-stop-db-exit"><h3>stop-db-exit</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(stop-db-exit &amp; [options])</code></div><div class="doc"><pre class="plaintext">Stop the standalone Elasticsearch DB and exit.
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-143">view source</a></div></div><div class="public anchor" id="var-sync-models-to-db"><h3>sync-models-to-db</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(sync-models-to-db)</code></div><div class="doc"><pre class="plaintext">Ensure all models in memory are indexed by Elasticsearch DB
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-104">view source</a></div></div><div class="public anchor" id="var-wait-for-green"><h3>wait-for-green</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(wait-for-green)</code></div><div class="doc"><pre class="plaintext">Wait for the DB be in the GREEN status
</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-93">view source</a></div></div><div class="public anchor" id="var-with-db"><h3>with-db</h3><h4 class="type">macro</h4><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(with-db options &amp; body)</code></div><div class="doc"><pre class="plaintext">Run PAMELA operations on database.  If the :database option
 is set then connect to that remote server, otherwise
 run a local, standalone DB.

The DB will be started, body executed, then DB shutdown.
This macro will catch any exceptions and ensure the DB
is shutdown cleanly and then the process will exit.</pre></div><div class="src-link"><a href="https://bitbucket.org/dollinc-pamela/pamela/src/master/code/src/main/clj/pamela/db.clj#cl-344">view source</a></div></div></div></body></html>